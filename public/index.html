<!DOCTYPE html> 
<html>
<head>
	<meta charset="utf-8">
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js"></script>
	<script type="text/javascript">
		angular.module('myApp', [])
		.controller('StoreController', function($http) {
			var storeCtlr = this;
			storeCtlr.address = "";
			storeCtlr.stores = []; // stores -> [{id:411, name, ...}, {id:123,...}]
			storeCtlr.sales = {}; // sales -> {411 : [{productId,...}], 123: [...] }
			storeCtlr.currentStore = 1;

			storeCtlr.getStores = function() {
				$http.get('https://codybo.herokuapp.com/lcbo-nearby?geo=' + encodeURIComponent(storeCtlr.address))
				.then(function(res) {
						storeCtlr.stores = res.data; // auto-converted to JSON object
				}, function(err) {
					console.log('Error while loading getStores');
				}); // then
			};

			storeCtlr.getSales = function(storeId) {
				$http.get('https://codybo.herokuapp.com/lcbo/' + storeId)
				.then(function(res) {
						storeCtlr.sales[storeId] = res.data; 

				}, function(err) {
					console.log('Error while loading getSales');
				}); // then				
			};
		}); // StoreController
	</script>

</head>
<body ng-app="myApp">
	<div ng-controller="StoreController as mc">
		<input type="text" ng-model="mc.address">
		<input type="submit" ng-click="mc.getStores()" value="Submit">
		<ul>
			<li ng-repeat="s in mc.stores">

 				<button ng-click="mc.getSales(s.id)">{{s.name}}</button> {{s.address_line_1}} | {{s.city}} | {{s.postal_code}}</span>
				<div id="sales_{{s.id}}">
				</div>
			</li>
		</ul>

    </div>

<!--

    <div>
		<p>10 stores nearest to your current position</p>
		<img src="loading.gif" id="spin">
		<div id="url" style="display: none;"> </div>
		<div id="geo"> </div>   
		</script> 
		<script >     
			navigator.geolocation.getCurrentPosition(function(position) {
  				url = "https://codybo.herokuapp.com/lcbo-nearby?lat=" + position.coords.latitude + "&lon=" + position.coords.longitude;
  				document.getElementById("url").innerText = url;
  				$.getJSON(url).then(function(data) {
  					data.forEach(function(store) {
  						var newP = document.createElement("p");
  						newP.innerText = store.tags;
  						document.getElementById("geo").appendChild(newP);
  						document.getElementById("spin").style.display = "none";
  					})
            		
        		});	
			});
		</script>    
    </div>


-->
	</body>
</html>